<!DOCTYPE html>
<html>

<head>

  <script src='dist/fhir-client-v2.js'></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

  <style>
    #main {
      background: lightgray;
      margin: 1em;
      padding: 1em;
      font-size: 2em;
    }
  </style>
</head>

<body>

  <div id="main">
    <h2>All Patient IDs</h2>
    <table>
      <tbody id="patient-id-table"></tbody>
    </table>

    <h2>All Condition IDs</h2>
    <table>
      <tbody id="condition-id-table"></tbody>
    </table>

  </div>

  <script>

    var myApp = {}

    FHIR.oauth2.ready()
      .then(function (client) {
        myApp.smart = client
        searchPatient()
      })

    async function searchCondition(patient) {
      console.log(patient.resource.id);
      $("#patient-id-table").append("<tr><td><div class='patient-id'>" + patient.resource.id + "</div></td></tr>");
    }

    async function searchPatient() {

      var query = new URLSearchParams();
      var genders = ['male', 'female'];
      query.set("gender", genders.join(","));
      var patientRef = await myApp.smart.request(
        "Patient?" + query, {
        pageLimit: 0,   // get all pages
      });
      console.log(patientRef[0].entry);
      console.log(patientRef[0].entry.length);

      patientRef.forEach(function (page) {
        page.entry.forEach(searchCondition(patient));
      });

    }
  </script>

</body>

</html>